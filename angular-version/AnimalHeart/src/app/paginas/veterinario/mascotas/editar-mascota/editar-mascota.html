<app-header-vet [veterinario]="veterinario" [error]="error"></app-header-vet>

<div class="form-container">
  <div class="form-body">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      
      <div class="form-section">
        <h2 class="form-section-title">
          <i class="bi bi-camera"></i>Foto de la Mascota
        </h2>
        <div class="photo-container">
          <img [src]="form.value.fotoUrl || (form.value.tipo === 'Gato' ? '/assets/images/defaultGato.png' : '/assets/images/defaultPerro.jpg')" 
               class="photo-preview"
               (error)="onImageError()">
          <div class="photo-placeholder" *ngIf="!form.value.fotoUrl">
            <i class="bi bi-camera me-2"></i> Imagen de la mascota
          </div>
        </div>
        
        <div class="form-field">
          <label class="form-label">URL de la Foto</label>
          <input type="url" formControlName="fotoUrl" class="form-control" 
                 placeholder="https://ejemplo.com/imagen.jpg"
                 (input)="onFotoUrlChange()">
          <div class="form-text">Pega la URL de una imagen o deja vacío para usar imagen por defecto</div>
        </div>
      </div>

      <div class="form-section">
        <h2 class="form-section-title">
          <i class="bi bi-info-circle"></i>Información de la Mascota
        </h2>
        
        <div class="form-grid">
          <div class="form-field">
            <label class="form-label required">Nombre de la Mascota</label>
            <input type="text" formControlName="nombre" class="form-control" required 
                   placeholder="Ej: Firulais" />
            <div *ngIf="submitted && f['nombre'].errors" class="error-message">
              <div *ngIf="f['nombre'].errors['required']">El nombre es requerido</div>
              <div *ngIf="f['nombre'].errors['minlength']">El nombre debe tener al menos 2 caracteres</div>
            </div>
          </div>

          <div class="form-field">
            <label class="form-label required">Tipo de Animal</label>
            <select formControlName="tipo" class="form-select" required (change)="onTipoChange()">
              <option value="">Seleccionar...</option>
              <option value="Perro">Perro</option>
              <option value="Gato">Gato</option>
            </select>
            <div *ngIf="submitted && f['tipo'].errors" class="error-message">
              <div *ngIf="f['tipo'].errors['required']">El tipo es requerido</div>
            </div>
          </div>

          <div class="form-field">
            <label class="form-label">Raza</label>
            <input type="text" formControlName="raza" class="form-control" 
                   placeholder="Ej: Criollo, Labrador, etc." />
          </div>

          <div class="form-field">
            <label class="form-label required">Edad (años)</label>
            <input type="number" formControlName="edad" class="form-control" min="0" max="30" required 
                   placeholder="Ej: 3" />
            <div *ngIf="submitted && f['edad'].errors" class="error-message">
              <div *ngIf="f['edad'].errors['required']">La edad es requerida</div>
              <div *ngIf="f['edad'].errors['min']">La edad mínima es 0</div>
            </div>
          </div>

          <div class="form-field">
            <label class="form-label">Peso (kg)</label>
            <input type="number" step="0.1" formControlName="peso" class="form-control" 
                   placeholder="Ej: 5.2" min="0" />
            <div *ngIf="submitted && f['peso'].errors" class="error-message">
              <div *ngIf="f['peso'].errors['min']">El peso mínimo es 0.1</div>
              <div *ngIf="f['peso'].errors['max']">El peso máximo es 100</div>
            </div>
          </div>

          <div class="form-field">
            <label class="form-label">Enfermedad/Diagnóstico</label>
            <input type="text" formControlName="enfermedad" class="form-control" 
                   placeholder="Ej: Ninguna, Alergias, etc." />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2 class="form-section-title">
          <i class="bi bi-person"></i>Información del Dueño
        </h2>
        
        <div class="form-field">
          <label class="form-label required">Seleccionar Cliente</label>
          <select formControlName="clienteId" class="form-select" required>
            <option value="">Seleccionar cliente...</option>
            <option *ngFor="let c of clientes" [value]="c.id">
              {{ c.nombre }} - C.C. {{ c.cedula }}
            </option>
          </select>
          <div *ngIf="submitted && f['clienteId'].errors" class="error-message">
            <div *ngIf="f['clienteId'].errors['required']">Debe seleccionar un cliente</div>
          </div>
        </div>

        <div *ngIf="form.get('clienteId')?.value" class="client-card">
          <div class="client-info">
            <div class="client-avatar">
              <i class="bi bi-person"></i>
            </div>
            <div class="client-details">
              <h4>{{ getClienteSeleccionado()?.nombre }}</h4>
              <p>C.C. {{ getClienteSeleccionado()?.cedula }} | {{ getClienteSeleccionado()?.correo }} | {{ getClienteSeleccionado()?.celular }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-field">
          <div class="form-check">
            <input id="activo" type="checkbox" class="form-check-input" formControlName="activo">
            <label for="activo" class="form-check-label">Mascota activa</label>
          </div>
        </div>
      </div>

      <div class="btn-container">
        <button type="button" class="btn-secondary" (click)="onCancel()">
          <i class="bi bi-x-circle me-2"></i>Cancelar
        </button>
        <button type="submit" class="btn-primary" [disabled]="cargando">
          <i class="bi bi-check-circle me-2"></i>Guardar cambios
        </button>
      </div>

      <div *ngIf="successMessage" class="alert alert-success mt-3">
        <i class="bi bi-check-circle me-2"></i>{{ successMessage }}
      </div>
      <div *ngIf="errorMessage" class="alert alert-danger mt-3">
        <i class="bi bi-exclamation-triangle me-2"></i>{{ errorMessage }}
      </div>
    </form>
  </div>
</div>