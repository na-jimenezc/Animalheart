<div class="dashboard-container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0"></h1>
    <button class="btn btn-primary" (click)="refreshDashboard()" [disabled]="loading">
      <i class="fas fa-sync-alt me-2" [class.fa-spin]="loading"></i>
      Actualizar
    </button>
  </div>

  <!--Carganding-->
  @if (loading) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2 text-muted">Cargando datos del dashboard...</p>
    </div>
  }

  <!--Mensaje de error-->
  @if (error && !loading) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <strong>Error:</strong> {{ error }}
      <button type="button" class="btn-close" (click)="error = ''"></button>
    </div>
  }

  <!--Dashboard -->
  @if (!loading && !error) {
    <div class="row g-3">
      
      <div class="col-xl-3 col-md-6">
        <app-total-tratamientos-mes 
          [totalTratamientos]="dashboardData.totalTratamientosUltimoMes"
          [loading]="loading">
        </app-total-tratamientos-mes>
      </div>

      <!-- Veterinarios Activos -->
      <div class="col-xl-3 col-md-6">
        <div class="card vet-card">
          <div class="card-header vet-card-header vet-activos-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-user-md me-2"></i>
              Veterinarios Activos
            </h5>
          </div>
          <div class="card-body vet-card-body">
            <div class="vet-icon vet-activos-icon">
              <i class="fas fa-user-check"></i>
            </div>
            <div class="vet-count">{{ dashboardData.veterinariosActivos }}</div>
            <div class="vet-title">Profesionales Activos</div>
            <div class="vet-subtitle">Disponibles para consultas</div>
          </div>
        </div>
      </div>

      <!-- Veterinarios Inactivos -->
      <div class="col-xl-3 col-md-6">
        <div class="card vet-card">
          <div class="card-header vet-card-header vet-inactivos-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-user-md me-2"></i>
              Veterinarios Inactivos
            </h5>
          </div>
          <div class="card-body vet-card-body">
            <div class="vet-icon vet-inactivos-icon">
              <i class="fas fa-user-times"></i>
            </div>
            <div class="vet-count">{{ dashboardData.veterinariosInactivos }}</div>
            <div class="vet-title">Profesionales Inactivos</div>
            <div class="vet-subtitle">No disponibles temporalmente</div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6">
        <app-mascotas-totales-activas
          [totalMascotas]="dashboardData.totalMascotas"
          [mascotasActivas]="dashboardData.mascotasActivas"
          [loading]="loading">
        </app-mascotas-totales-activas>
      </div>

      <div class="col-xl-3 col-md-6">
        <app-ventas-totales
          [ventasTotales]="dashboardData.ventasTotales"
          [loading]="loading">
        </app-ventas-totales>
      </div>
      <div class="col-xl-3 col-md-6">
        <app-ganancias-totales
          [gananciasTotales]="dashboardData.gananciasTotales"  
          [loading]="loading">
        </app-ganancias-totales>
      </div>
      <div class="col-12">
        <div class="row g-3">
          
          <div class="col-lg-6">
            <app-tratamientos-tipo-medicamento
              [tratamientosPorMedicamento]="dashboardData.tratamientosPorMedicamento"
              [loading]="loading">
            </app-tratamientos-tipo-medicamento>
          </div>

          <div class="col-lg-6">
            <app-top3-tratamientos
              [top3Tratamientos]="dashboardData.top3Tratamientos"
              [loading]="loading">
            </app-top3-tratamientos>
          </div>

          <div class="col-12">
            <div class="card veterinarios-card">
              <div class="card-header veterinarios-header">
                <h5 class="card-title mb-0">
                  <i class="fas fa-users me-2"></i>
                  Todos los Veterinarios
                </h5>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table veterinarios-table">
                    <thead>
                      <tr>
                        <th>Nombre</th>
                        <th>Especialidad</th>
                        <th>Usuario</th>
                        <th>Estado</th>
                        <th>Consultas Realizadas</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (vet of dashboardData.todosVeterinarios; track vet.id || $index) {
                        <tr>
                          <td class="fw-bold">{{ vet.nombre }}</td>
                          <td>{{ vet.especialidad }}</td>
                          <td>{{ vet.nombreUsuario }}</td>
                          <td>
                            <span [class]="vet.activo === 1 ? 'badge-estado badge-activo' : 'badge-estado badge-inactivo'">
                              {{ vet.activo === 1 ? 'Activo' : 'Inactivo' }}
                            </span>
                          </td>
                          <td>
                            <span class="badge-consultas">{{ vet.consultas || 0 }}</span>
                          </td>
                        </tr>
                      } @empty {
                        <tr>
                          <td colspan="5" class="no-veterinarios">
                            <i class="fas fa-user-md fa-2x mb-2 d-block"></i>
                            No hay veterinarios registrados
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>