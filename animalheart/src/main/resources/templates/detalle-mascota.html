<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title th:text="${mascota.nombre} + ' | Animalheart'">Detalle | Animalheart</title>

  <!-- Bootstrap / Icons / Poppins -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Hoja global del sitio -->
  <link th:href="@{/CSS/estilos.css}" rel="stylesheet">
</head>

<body class="bg-light pet-detail">
  <!-- ===================== BARRA SUPERIOR ===================== -->
  <nav class="barra">
    <div class="envoltura">
      <div class="menu-izq align-items-center">
        <img th:src="@{/IMAGES/Logo_2.png}" alt="Animalheart" class="vmk-brand" />
        <a th:href="@{/mascotas}" class="vmk-btn vmk-btn--ghost">
          <i class="bi bi-arrow-left"></i> Regresar
        </a>
        <a th:href="@{/mascotas/nueva}" class="vmk-btn vmk-btn--outline">
          <i class="bi bi-plus-circle"></i> Registrar Mascota
        </a>
      </div>
      <div class="menu-der">
        <a th:href="@{/login-veterinario}" class="vmk-btn vmk-btn--danger">
          <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
        </a>
      </div>
    </div>
  </nav>

  <!-- ===================== CONTENIDO ===================== -->
  <main class="vet-container my-4">
    <div class="row g-4">
      <!-- ===== Columna izquierda (ficha) ===== -->
      <aside class="col-12 col-lg-4 col-xl-3">
        <div class="card shadow-sm pet-card">
          <div class="pet-photo-wrap">
            <img th:src="${mascota.fotoURL}" th:alt="${mascota.nombre}" class="pet-photo">
          </div>

          <h2 class="pet-name" th:text="${mascota.nombre}">Firulais</h2>

          <!-- Métricas (chips 2x2) -->
          <div class="pet-metrics">
            <div class="pet-chip">
              <i class="bi bi-hourglass-split"></i>
              <span><strong>Edad</strong> <span th:text="${mascota.edad}">3</span> años</span>
            </div>
            <div class="pet-chip">
              <i class="bi bi-gender-ambiguous"></i>
              <span><strong>Tipo</strong> <span th:text="${mascota.tipo}">Perro</span></span>
            </div>
            <div class="pet-chip">
              <i class="bi bi-badge-ad"></i>
              <span><strong>Raza</strong> <span th:text="${mascota.raza}">Criollo</span></span>
            </div>
            <div class="pet-chip">
              <i class="bi bi-clipboard-heart"></i>
              <span><strong>Peso</strong> <span th:text="${mascota.peso}">25.4</span> kg</span>
            </div>
          </div>

          <!-- Información del Dueño -->
          <div class="pet-owner mt-3" th:if="${mascota.cliente != null}">
            <div class="pet-owner-title">
              <span>Información del Dueño</span>
              <i class="bi bi-person-circle"></i>
            </div>

            <div class="pet-field">
              <i class="bi bi-person-badge"></i>
              <div>
                <small>Cédula</small>
                <div th:text="${mascota.cliente.cedula}">123456789</div>
              </div>
            </div>

            <div class="pet-field">
              <i class="bi bi-person"></i>
              <div>
                <small>Nombre</small>
                <div th:text="${mascota.cliente.nombre}">Carlos Ruiz</div>
              </div>
            </div>

            <div class="pet-field">
              <i class="bi bi-envelope"></i>
              <div>
                <small>Correo</small>
                <div th:text="${mascota.cliente.correo}">carlos@email.com</div>
              </div>
            </div>

            <div class="pet-field">
              <i class="bi bi-telephone"></i>
              <div>
                <small>Celular</small>
                <div th:text="${mascota.cliente.celular}">3214567890</div>
              </div>
            </div>
          </div>

          <div class="pet-owner mt-3" th:unless="${mascota.cliente != null}">
            <div class="pet-owner-title">
              <span>Información del Dueño</span>
              <i class="bi bi-exclamation-triangle"></i>
            </div>
            <div class="text-center text-muted py-3">
              <i class="bi bi-info-circle"></i>
              <small>No hay información del dueño registrada</small>
            </div>
          </div>
        </div>
      </aside>

      <!-- ===== Columna derecha (historial) ===== -->
      <section class="col-12 col-lg-8 col-xl-9">
        <div class="card shadow-sm pet-main">
          <h3 class="pet-main-title">
            <i class="bi bi-file-medical"></i> Historial Médico
          </h3>

          <!-- Salud -->
          <div class="pet-section">
            <div class="pet-section-title">Salud</div>
            <div class="row gx-3 gy-2 align-items-center">
              <div class="col-auto">
                <span class="fw-semibold">Diagnóstico</span>
              </div>
              <div class="col">
                <span th:if="${mascota.enfermedad != null and !mascota.enfermedad.isEmpty()}" 
                      th:text="${mascota.enfermedad}" class="text-info fw-medium">Ninguno</span>
                <span th:unless="${mascota.enfermedad != null and !mascota.enfermedad.isEmpty()}" 
                      class="text-muted">Ninguno</span>
              </div>
            </div>
          </div>

          <!-- Tratamientos -->
          <div class="pet-section">
            <div class="pet-section-title">Tratamientos</div>
            
            <div th:if="${mascota.tratamientos != null and !mascota.tratamientos.isEmpty()}">
              <div class="tratamiento-item mb-3 p-3 border rounded" th:each="tratamiento : ${mascota.tratamientos}">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <h6 class="mb-1" th:text="${tratamiento.medicamento != null ? tratamiento.medicamento.nombre : 'Medicamento no especificado'}">Amoxicilina</h6>
                    <small class="text-muted">
                      <i class="bi bi-calendar"></i> 
                      <span th:text="${#temporals.format(tratamiento.fecha, 'dd/MM/yyyy')}">01/01/2024</span>
                    </small>
                  </div>
                  <span class="badge bg-primary">
                    <i class="bi bi-capsule"></i> 
                    <span th:text="${tratamiento.cantidadUsada}">2</span> unidades
                  </span>
                </div>
                <div th:if="${tratamiento.veterinario != null}" class="mt-2">
                  <small class="text-muted">
                    <i class="bi bi-person-badge"></i> 
                    Aplicado por: <span th:text="${tratamiento.veterinario.nombre}">Dr. Juan Pérez</span>
                  </small>
                </div>
              </div>
            </div>
            
            <div th:unless="${mascota.tratamientos != null and !mascota.tratamientos.isEmpty()}" class="pet-notepad">
              <div class="text-center text-muted py-4">
                <i class="bi bi-inbox display-4"></i>
                <p class="mt-2">No hay tratamientos registrados</p>
                <small>Los tratamientos aparecerán aquí cuando sean aplicados</small>
              </div>
            </div>
          </div>

          <div class="text-center mt-3">
            <a th:href="@{'/mascotas/' + ${mascota.id} + '/tratamiento/nuevo'}" class="btn btn-lg pet-cta">
              <i class="bi bi-capsule"></i> Dar Tratamiento
            </a>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- ===================== FOOTER ===================== -->
  <footer class="pie py-3">
    <div class="container text-center">
      <p class="mb-0 text-white"><i class="bi bi-c-circle"></i> 2025 - Animalheart</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>